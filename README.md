# FFmpeg 脚本 (Windows 批处理版本)

这是一个简易的 FFmpeg 脚本，集成了多种音视频处理功能，支持批量操作，满足了快速处理日常音视频的需求。


## 作者在用的 FFmpeg 版本下载链接：
[Windows builds from gyan.dev latest release-full version: 8.0](https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-full.7z)  
（下载后解压并将 `bin` 目录添加到系统 PATH 即可使用）


### 使用过程中有任何bug都请提出，我会尽快修复


## 功能特性

- 🎯 **视频转码**：支持 H.264、HEVC/H.265、AV1 格式互转，可自定义编码配置（如 main/high 等profile）、分辨率、码率等参数。
- ⚡ **硬件加速**：支持 CPU 软件编解码，以及 NVIDIA（CUVID/NVENC）、Intel（QSV）、AMD（AMF）显卡的硬件编解码加速。
- 🎞️ **MP4转GIF**：一键将视频转为动图，支持自定义分辨率（建议较小尺寸）和帧率（建议10-15fps以平衡文件大小和流畅度）。
- 🎥 **提取视频流**：快速剥离视频中的音频，仅保留视频流（视频直接复制，不重新编码，速度极快），输出文件自动添加 `-without-audio` 后缀。
- 🔊 **音轨/字幕处理**：转码时可选择复制音轨、忽略音轨或自定义音频参数；字幕支持复制、跳过或自定义处理。
- 📁 **批量处理**：自动读取 `input` 目录中所有文件（忽略 `.gitkeep`），处理后输出到 `output` 目录。
- 📊 **进度统计**：每个流程结束后显示成功/失败文件数量，便于排查问题。


## 系统要求

- 已安装 FFmpeg 并添加到系统 PATH（建议使用上述链接的版本）
- 若使用硬件加速：需对应品牌显卡（NVIDIA/Intel/AMD）并安装最新驱动


## 使用方法

### 1. 准备工作
将需要处理的文件放入 `input` 文件夹中（无需删除`.gitkeep`文件，脚本运行时会自动排除）


### 2. 运行脚本
双击 `启动.bat` 启动脚本，根据主菜单提示选择功能：
- 输入 `1`：进入视频转码流程（可自定义编码格式、分辨率、码率等）
- 输入 `2`：进入 MP4 转 GIF 流程（可调整分辨率和帧率）
- 输入 `3`：进入提取视频流流程（仅保留视频，忽略音频）


### 3. 跟随引导完成设置
根据所选功能的提示，逐步选择参数（如编码格式、分辨率、帧率等），默认选项可直接按回车确认。


### 4. 开始处理
确认参数后，脚本将自动批量处理 `input` 目录中的文件，结果输出到 `output` 目录。


## 目录结构

```
脚本所在目录/
│
├── 启动.bat    # 主脚本文件
├── input/              # 输入目录（存放待处理文件）
│   ├── .gitkeep        # 占位文件（自动忽略，无需删除）
│   └── 视频文件.mp4    # 待处理的视频文件（支持多种格式）
│
└── output/             # 输出目录（自动创建）
    ├── 转码后的视频.mp4    # 视频转码结果
    ├── 动图.gif           # MP4转GIF结果
    └── 视频-without-audio.mp4  # 提取视频流结果
```


## 注意事项

1. **硬件加速兼容性**：
   - 不同显卡对编码格式的支持不同（如老款NVIDIA显卡可能不支持AV1编码），不确定时建议选择CPU软编码。
   - 解码时若选择硬件加速失败，可切换为CPU软件解码（兼容性最佳）。

2. **GIF转换建议**：
   - 由于GIF格式限制，建议分辨率不超过1080p，帧率10-15fps，避免文件过大。

3. **文件格式**：
   - 脚本会处理 `input` 目录中所有文件，请确保文件格式为FFmpeg支持的音视频格式（如MP4、MKV、MOV等）。

4. **资源占用**：
   - 视频转码（尤其是CPU软编码）可能占用大量系统资源，建议处理时关闭其他占用资源的程序。


## 故障排除

- 若提示“ffmpeg 不是内部或外部命令”：检查FFmpeg是否正确安装并添加到系统PATH。
- 硬件加速失败：尝试切换为CPU软编码，或更新显卡驱动。
- 转换/提取失败：检查输入文件是否损坏，或尝试更换参数（如降低分辨率、调整码率）。
- 输出目录无文件：确认 `input` 目录中是否有非 `.gitkeep` 的有效文件。


## 许可证

此脚本采用 MIT 许可证开源，可自由使用和修改。


---

*提示：使用前建议用 MediaInfo 工具查看源文件编码信息，以便更准确地选择参数。*